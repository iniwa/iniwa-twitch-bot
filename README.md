**このreadmeも含め、全てをAIを利用して作成しました。MIT Licenseです。**  

# **Iniwa`s Twitch BOT**

Twitch配信のための多機能な自作Bot＆管理ダッシュボードです。

Dockerコンテナとして動作し、視聴者の行動ログ保存、配信アナリティクス、チャンネルポイント予想の管理、配信アーカイブの自動ダウンロードまでをWeb GUIから一元管理できます。

## **🚀 主な機能**

### **1\. 📊 ダッシュボード (Web GUI)**

* **視聴者リスト:** 現在の視聴者、滞在時間、コメント数、過去の訪問回数などをリアルタイム表示。  
* **メモ機能:** 視聴者一人ひとりに対して個別のメモ（覚え書き）を保存可能。  
* **配信プリセット:** タイトル、カテゴリー、タグ、ツイート用タグをプリセットとして保存し、ワンクリックで適用。  
* **X (Twitter) 連携:** 設定したタグを含めて配信開始ポストを素早く作成。

### **2\. 📈 アナリティクス & ログ**

* **配信履歴:** 過去の配信ごとの同接数推移、コメント速度、スタンプ使用率などをグラフ化。  
* **カレンダー表示:** 月ごとの配信頻度や時間をカレンダー形式で確認。  
* **視聴者分析:** フォロワーの増減履歴、個別の視聴者の参加頻度や累計視聴時間を追跡。  
* **チャットログ:** 配信ごとのチャット、ビッツ、サブスク、ポイント使用ログを保存・閲覧。

### **3\. 🎰 インタラクティブ機能**

* **チャンネルポイント予想 (賭博):** 予想の作成（開始）、結果の確定、キャンセル（返金）をGUIから操作可能。  
* **自動チャット:** 「定期コメント」や「特定キーワードへの反応」を設定可能。  
* **Shoutout (SO):** GUI上のボタンから、指定した配信者の紹介（SO）コマンドを実行。

### **4\. 🎥 アーカイブ自動管理**

* **自動ダウンロード:** yt-dlp を使用し、配信終了後にアーカイブ（VOD）を自動で保存。  
* **保存管理:** ダウンロード済みファイルの管理、再ダウンロード、削除が可能。

## **🛠 動作環境**

* **Docker Engine**  
* **Docker Compose**

本ツールはDockerコンテナ上で動作するため、PythonやFFmpegをホストマシンに直接インストールする必要はありません。

## **⚙️ セットアップ手順**

### **1\. リポジトリの準備**

リポジトリをクローン（またはファイルを配置）し、ディレクトリに移動します。

```cmd
git clone https://github.com/iniwa/twitch-tool.git
cd twitch-tool
```

### **2\. compose.yaml の確認と編集**

同梱の compose.yaml を環境に合わせて編集してください。

特に **動画保存先（volumes）** の設定は重要です。

デフォルトでは /mnt/nas/video/twitch-archive が指定されていますが、ご自身の環境のパスに合わせて変更してください。

```yaml
    volumes:  
      \- .:/app  
      \# ↓ここを保存したいディレクトリパスに変更してください  
      \- /mnt/nas/video/twitch-archive:/app/downloads
```

### **3\. ビルドと起動**

以下のコマンドでコンテナをビルドし、バックグラウンドで起動します。

```cmd
docker compose up \-d \--build
```

### **4\. 初期設定 (Web GUI)**

起動後、ブラウザで以下のURLにアクセスしてください。

👉 http://localhost:8501

(またはDockerホストのIPアドレス:8501)

初回アクセス時に設定画面が開きます。以下のTwitch API情報を入力してください。

* **Client ID**: Twitch Developer Consoleで取得  
* **Access Token**: BotアカウントのUser Access Token  
* **Broadcaster ID**: 配信者のユーザーID（数字）  
* **Bot User ID**: BotアカウントのユーザーID（数字）

### **5\. 停止方法**

```cmd
docker compose down
```

## **📁 ディレクトリ構成**

* app.py: Flask Webサーバー、ルーティング処理  
* workers.py: バックグラウンド処理（Twitch接続、ログ収集、ダウンロード処理）  
* templates.py: HTMLテンプレート  
* config.py: 設定読み込み  
* Dockerfile / compose.yaml: Docker環境定義ファイル  
* data/: **(永続化対象)** 設定ファイルやログデータの保存先  
  * config.json: 設定ファイル（自動生成）  
  * viewers.json: 視聴者データベース  
  * history/: 配信ごとのログ (.jsonl)  
* downloads/: **(永続化対象)** ダウンロードされた配信アーカイブ（compose.yamlでマウント先を指定）

## **📝 開発者向けノート**

* **権限設定:** compose.yaml 内で user: "1000:1000" を指定しています。Linux環境の場合、マウント先のディレクトリ（data や保存先パス）の所有権限が UID 1000 のユーザーで書き込み可能であることを確認してください。  
* **JST対応:** コンテナ内のタイムゾーンは TZ=Asia/Tokyo に設定済みです。  
* **永続化:** data/ ディレクトリはバインドマウント（.:/app）によりホスト側のディレクトリと同期されます。

## **⚠️ 免責事項**

このツールは個人利用を目的としています。Twitch APIの利用規約に従って使用してください。アーカイブのダウンロード機能は、自身のチャンネルのバックアップ目的でのみ使用することを推奨します。